# Geth测试脚本

+ 运行平台：Linux、macOS

### 运行前工作

+ 系统需先安装多重视窗管理程序screen
+ 根据注释修改`test.sh`中第2、3、4行的路径变量
+ 保证`test.sh`中的SM与genesis.json中cryptoType相等。SM="0"为不使用国密，SM="0"使用国密。

### 使用方法

测试时先正确执行test.sh，系统中启动了5个geth节点即可认为正确执行。

然后运行testChain包，进行5个节点的购币转账打包共识操作。

运行结束后，启动的五个节点和交易所后台需要手动运行`killProc.sh`停止。

如果不更改SM进行多次测试，只需在第一次运行`test.sh`即可。

更改SM测试时，需要先运行`test.sh`。

### 运行时原理流程

#### test.sh

+ 强制结束所有占用端口1323和8545-8549的进程
+ 本地启动交易所exchange
+ 强制删除空文件夹中的所有文件
+ 在空文件夹中建立文件树，初始化5个节点
+ 在五个节点数据中分别拷贝geth账户
+ 分别启动五个节点

#### testChain

+ 5个节点两两添加
+ 生成4个零知识证明系统账户信息Alice、Bob、Calvin、David
+ 向监管者注册上述4个账户
+ Alice向监管方购买100单位金额代币
+ 使上述购币行为共识生效
+ Alice花费上述购币承诺，向Bob转5单位金额，找零为95金额
+ 使上述转账行为共识生效
+ Bob向Calvin转账，花费收到的5元承诺，转出2元，找零3元
+ 使上述转账行为共识生效
+ 测试完毕，测试通过

若未输出“测试完毕，测试通过”，则可以根据程序输出获得错误信息。

测试程序正确输出样例：

```go
5个节点两两添加成功
节点0账户为交易所账户
节点0账户 [0x47c9a59fe5d28ff862f8eaf5924dbc90af00b0ce]
节点1账户 [0x19dbca3be6358f474caea47a0f177a33afa5a1d2]
节点2账户 [0xf17d78b504e271ea28523ac4eb39c4ecd1a86349]
节点3账户 [0x2c03bc23e7cc213cae42f5a6591c8a4789784ca8]
节点4账户 [0xec349a9e1661b96e83fd2e761c22ddacf47141b3]
生成账户A 私钥： 14659973654862432690533920671460018707451824045173273744483699904857172700281
生成账户B 私钥： 16048534895344742265090129892843107462643013365338157597301762920300034270281
生成账户C 私钥： 1019768212853628477814793940102552210367951657540093257534254515863573691139
生成账户D 私钥： 12529964163529356179564556179137906160281194727346654055147170356347354135824
账户A注册成功
账户B注册成功
账户C注册成功
账户D注册成功
账户A购买100金额的代币
账户A购买100金额代币成功 购币交易Hash: 0x217d19bbb5b04d7cd5ffd0d34818251b602bcd71bcb4a9ef14f7610dfb5c336b
打包共识使交易 0x217d19bbb5b04d7cd5ffd0d34818251b602bcd71bcb4a9ef14f7610dfb5c336b 生效
交易 0x217d19bbb5b04d7cd5ffd0d34818251b602bcd71bcb4a9ef14f7610dfb5c336b 已被打包
交易 0x217d19bbb5b04d7cd5ffd0d34818251b602bcd71bcb4a9ef14f7610dfb5c336b 已被共识
账户A花费上述购币承诺，向账户B转5单位金额，找零为95金额
转账交易发送成功，待打包共识
打包共识使交易 0x521b551a891ee4c36f83e73b22be6d4621e7d794645a82da34da6f34ebc84275 生效
交易 0x521b551a891ee4c36f83e73b22be6d4621e7d794645a82da34da6f34ebc84275 已被打包
交易 0x521b551a891ee4c36f83e73b22be6d4621e7d794645a82da34da6f34ebc84275 已被共识
接收方B用自己的私钥解密得到交易金额
找零额承诺为 0x0c08d0b27d52e9d02d249632b2ae330e46c721e725e9f60f42c16c575fa0b692 随机数为0x14c81a490e43b399a10c67794bbbac3194212c1fed6536e9a1a239712f15b2f9
发送额为 0x5 承诺为 0x1936a6a86e7591405dd34ef93bfadb43373a427ad1034809aad2f9f776ed7e54 随机数为0x17d8c3463864fe50cffc20cccbfa5d6fc980c92daeed3a388d5bb2e6928e4e5f
B向C转账，花费5元承诺，转出2元，找零3元
转账交易发送成功，待打包共识
打包共识使交易 0xc83926db088d3827a1736d540c2dc2a7d02d6728420518e6cb8d98e61c426c8f 生效
交易 0xc83926db088d3827a1736d540c2dc2a7d02d6728420518e6cb8d98e61c426c8f 已被打包
交易 0xc83926db088d3827a1736d540c2dc2a7d02d6728420518e6cb8d98e61c426c8f 已被共识
接收方C用自己的私钥解密得到交易金额
找零额承诺为 0x0341dbba39a90cba481ad3b83d4450dd230f7a38e4e4012582b318392d6dda49 随机数为0x2195386903017e6aabef75a979b7a2633905a1dd9eddb4cd5b4316b327286836
发送额为 0x2 承诺为 0x113dd079d8b43c0ade661283773be95c101b2ef872634f56d9e09440c489b3bc 随机数为0x041dd39e96029d5c17a6ffa09ea1314f9c78411185ff263e3cce7b9d1124e78c
测试完毕，测试通过

Process finished with exit code 0
```









